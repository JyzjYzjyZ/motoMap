local cameraSet = {
    [1082103809] = true,
    [280838147] = true,
    [280838148] = true,
    [1276329993] = true,
    [1276329999] = true,
    [106903569] = true,
    [47280146] = true,
    [302057492] = true,
    [1276330007] = true,
    [91977752] = true,
    [1276330012] = true,
    [307310620] = true,
    [1168443421] = true,
    [1257642018] = true,
    [1226569766] = true,
    [1226569767] = true,
    [729440296] = true,
    [729440297] = true,
    [1082525738] = true,
    [1226569772] = true,
    [1275306029] = true,
    [71237680] = true,
    [1275306038] = true,
    [1275306039] = true,
    [427558974] = true,
    [427558975] = true,
    [1132130371] = true,
    [1132130372] = true,
    [240789577] = true,
    [1293111370] = true,
    [88952906] = true,
    [1082103882] = true,
    [1082103881] = true,
    [351569993] = true,
    [444342351] = true,
    [444342352] = true,
    [1232427087] = true,
    [1125986388] = true,
    [1293111381] = true,
    [72390743] = true,
    [72390744] = true,
    [177051735] = true,
    [1082103898] = true,
    [978876506] = true,
    [493250652] = true,
    [177051741] = true,
    [142587995] = true,
    [169998427] = true,
    [975216736] = true,
    [975216737] = true,
    [762556513] = true,
    [423393379] = true,
    [1210652772] = true,
    [423393380] = true,
    [1210652774] = true,
    [762556517] = true,
    [169998434] = true,
    [1242257513] = true,
    [978876525] = true,
    [1298096238] = true,
    [1297256560] = true,
    [1297256562] = true,
    [1272508530] = true,
    [1213743218] = true,
    [975216758] = true,
    [975216759] = true,
    [978894968] = true,
    [1200994425] = true,
    [1213743225] = true,
    [1213743226] = true,
    [1273598079] = true,
    [696141952] = true,
    [727240833] = true,
    [727240834] = true,
    [723296389] = true,
    [176715910] = true,
    [966195335] = true,
    [1226133642] = true,
    [656717963] = true,
    [1273598091] = true,
    [178583695] = true,
    [176836754] = true,
    [1273598101] = true,
    [978894998] = true,
    [1273598103] = true,
    [1273598102] = true,
    [1226133659] = true,
    [39151773] = true,
    [727093410] = true,
    [879198377] = true,
    [300511412] = true,
    [1117757621] = true,
    [1074542777] = true,
    [232038587] = true,
    [232038588] = true,
    [513087676] = true,
    [1081538754] = true,
    [1081295045] = true,
    [1081295046] = true,
    [92190921] = true,
    [92190924] = true,
    [136796365] = true,
    [92190927] = true,
    [1081295056] = true,
    [1081295057] = true,
    [1077453009] = true,
    [48982230] = true,
    [300511446] = true,
    [53672154] = true,
    [1226133724] = true,
    [1226133731] = true,
    [169058535] = true,
    [1226133740] = true,
    [109691116] = true,
    [1066592494] = true,
    [70652145] = true,
    [168706289] = true,
    [109691122] = true,
    [1081835763] = true,
    [1075505397] = true,
    [1023488246] = true,
    [74721528] = true,
    [1066592506] = true,
    [676589819] = true,
    [1066592508] = true,
    [1198037245] = true,
    [1075505413] = true,
    [654530822] = true,
    [1074481414] = true,
    [9371912] = true,
    [1074481415] = true,
    [1075505414] = true,
    [1074481419] = true,
    [302080266] = true,
    [302080267] = true,
    [170301709] = true,
    [415492368] = true,
    [169961747] = true,
    [169961754] = true,
    [1075724576] = true,
    [339288353] = true,
    [1075724577] = true,
    [169961762] = true,
    [1100831012] = true,
    [161786151] = true,
    [371063082] = true,
    [1256479019] = true,
    [1256479018] = true,
    [170066227] = true,
    [426510645] = true,
    [1236896054] = true,
    [426510646] = true,
    [169961785] = true,
    [205179196] = true,
    [225859901] = true,
    [69159230] = true,
    [339288383] = true,
    [1302032704] = true,
    [1302032705] = true,
    [967960897] = true,
    [966187328] = true,
    [1302032710] = true,
    [967960905] = true,
    [330764622] = true,
    [870429007] = true,
    [1219436879] = true,
    [300808529] = true,
    [330764623] = true,
    [870429016] = true,
    [1292030302] = true,
    [1292030312] = true,
    [1292030313] = true,
    [1152352618] = true,
    [1152352619] = true,
    [1240469869] = true,
    [1240469870] = true,
    [44761456] = true,
    [587723123] = true,
    [1083545974] = true,
    [1219275130] = true,
    [339296635] = true,
    [138400124] = true,
    [868440444] = true,
    [1083545980] = true,
    [1292030335] = true,
    [1292030336] = true,
    [339296650] = true,
    [1292030346] = true,
    [987437458] = true,
    [667543958] = true,
    [48718236] = true,
    [870316446] = true,
    [170150308] = true,
    [1111058852] = true,
    [1310810534] = true,
    [1310810535] = true,
    [1272521128] = true,
    [1272521129] = true,
    [44681640] = true,
    [339296683] = true,
    [1213245863] = true,
    [1111058860] = true,
    [93862320] = true,
    [1213245874] = true,
    [1134739894] = true,
    [1134739895] = true,
    [1111058871] = true,
    [339296697] = true,
    [120930755] = true,
    [120930756] = true,
    [295084485] = true,
    [295084486] = true,
    [170078663] = true,
    [232167881] = true,
    [1227073995] = true,
    [1227073996] = true,
    [727185872] = true,
    [170078672] = true,
    [727185875] = true,
    [91963865] = true,
    [230099427] = true,
    [187783655] = true,
    [1274786281] = true,
    [339288557] = true,
    [339288559] = true,
    [1117800955] = true,
    [100880892] = true,
    [428147195] = true,
    [69159424] = true,
    [351425028] = true,
    [89371140] = true,
    [339288583] = true,
    [85711368] = true,
    [712589850] = true,
    [868336159] = true,
    [413714978] = true,
    [868336168] = true,
    [1119576620] = true,
    [769245741] = true,
    [302086702] = true,
    [1231065645] = true,
    [1231065648] = true,
    [1119576629] = true,
    [1206772278] = true,
    [1119576630] = true,
    [10691128] = true,
    [27583033] = true,
    [482847292] = true,
    [305406526] = true,
    [1119576649] = true,
    [1309272657] = true,
    [538432096] = true,
    [9704035] = true,
    [1274559079] = true,
    [1274559080] = true,
    [1078755949] = true,
    [807586420] = true,
    [1078755958] = true,
    [44472955] = true,
    [149844610] = true,
    [322757259] = true,
    [322757261] = true,
    [1232837265] = true,
    [1075481245] = true,
    [1075481246] = true,
    [330764958] = true,
    [330764959] = true,
    [761346730] = true,
    [761346731] = true,
    [136362666] = true,
    [136362670] = true,
    [244292278] = true,
    [693787321] = true,
    [169099963] = true,
    [693787323] = true,
    [169050821] = true,
    [136954567] = true,
    [35422924] = true,
    [70849229] = true,
    [97678033] = true,
    [1213666001] = true,
    [142588630] = true,
    [403948249] = true,
    [136954585] = true,
    [413862627] = true,
    [479210212] = true,
    [1213666028] = true,
    [1213666029] = true,
    [413862638] = true,
    [148490993] = true,
    [1154169587] = true,
    [1154169588] = true,
    [1068434171] = true,
    [1306782461] = true,
    [62681853] = true,
    [1213813505] = true,
    [1134785282] = true,
    [1302883078] = true,
    [135629576] = true,
    [1271040779] = true,
    [172665613] = true,
    [135629582] = true,
    [1213813520] = true,
    [1068434195] = true,
    [958890774] = true,
    [1302883094] = true,
    [1134785308] = true,
    [1134785309] = true,
    [328313630] = true,
    [1213666080] = true,
    [170599202] = true,
    [179018537] = true,
    [1068434222] = true,
    [977537840] = true,
    [68981552] = true,
    [977537842] = true,
    [177046322] = true,
    [695827250] = true,
    [170599228] = true,
    [170599229] = true,
    [68981566] = true,
    [422896445] = true,
    [245490499] = true,
    [176802631] = true,
    [705377104] = true,
    [192299870] = true,
    [162259810] = true,
    [960760674] = true,
    [192299876] = true,
    [1023523685] = true,
    [171232107] = true,
    [1292313452] = true,
    [171232108] = true,
    [967920494] = true,
    [967920495] = true,
    [967920496] = true,
    [171232109] = true,
    [295097206] = true,
    [49730422] = true,
    [160017271] = true,
    [967920506] = true,
    [1126658942] = true,
    [1227641729] = true,
    [72452994] = true,
    [1076605826] = true,
    [1292313483] = true,
    [1292313484] = true,
    [519934861] = true,
    [1228233614] = true,
    [1126658963] = true,
    [1126658965] = true,
    [137079703] = true,
    [311759767] = true,
    [967408541] = true,
    [967408542] = true,
    [436828153] = true,
    [1219496862] = true,
    [1219496863] = true,
    [12262312] = true,
    [988466090] = true,
    [577512365] = true,
    [177214390] = true,
    [51964856] = true,
    [257452994] = true,
    [72395715] = true,
    [68991941] = true,
    [1275296710] = true,
    [1275296711] = true,
    [1275296712] = true,
    [68991943] = true,
    [1208009677] = true,
    [1208009678] = true,
    [95513554] = true,
    [967408594] = true,
    [868402130] = true,
    [70650839] = true,
    [1208009689] = true,
    [1208009690] = true,
    [1208009691] = true,
    [1208009692] = true,
    [311759834] = true,
    [335668185] = true,
    [1208226784] = true,
    [1126188004] = true,
    [1126188005] = true,
    [1155777511] = true,
    [1155777512] = true,
    [1155777513] = true,
    [1126188011] = true,
    [219751409] = true,
    [49804277] = true,
    [1273359353] = true,
    [10677242] = true,
    [1290456060] = true,
    [1093745664] = true,
    [1290456065] = true,
    [1093745666] = true,
    [311759873] = true,
    [70220815] = true,
    [1093745684] = true,
    [1093745685] = true,
    [49228821] = true,
    [1121213462] = true,
    [49228829] = true,
    [10695710] = true,
    [11947045] = true,
    [38853671] = true,
    [1233286184] = true,
    [1233286185] = true,
    [781829163] = true,
    [1301570604] = true,
    [51964974] = true,
    [1233286192] = true,
    [47006770] = true,
    [1233286194] = true,
    [1242252341] = true,
    [1294773302] = true,
    [1294773303] = true,
    [676602938] = true,
    [672019517] = true,
    [1234562115] = true,
    [1213062212] = true,
    [421846087] = true,
    [1301570632] = true,
    [348775497] = true,
    [71232591] = true,
    [1197960271] = true,
    [1040161878] = true,
    [1197960278] = true,
    [1086780506] = true,
    [1083483226] = true,
    [1093745755] = true,
    [1093745764] = true,
    [461888614] = true,
    [1272337511] = true,
    [461888616] = true,
    [461888617] = true,
    [461888618] = true,
    [11947115] = true,
    [1209130095] = true,
    [45167727] = true,
    [1297216627] = true,
    [1271702645] = true,
    [1271702646] = true,
    [72084599] = true,
    [1209130104] = true,
    [1155683450] = true,
    [1209130107] = true,
    [1290067071] = true,
    [1290067073] = true,
    [1248990343] = true,
    [1248990344] = true,
    [1248990345] = true,
    [1248990346] = true,
    [160013449] = true,
    [91825294] = true,
    [1216429198] = true,
    [97559696] = true,
    [1299829904] = true,
    [39611535] = true,
    [1290439826] = true,
    [39611545] = true,
    [164142238] = true,
    [433779881] = true,
    [1308751021] = true,
    [1308751022] = true,
    [77864111] = true,
    [47226030] = true,
    [433779886] = true,
    [338642099] = true,
    [1074214073] = true,
    [1074214074] = true,
    [1267338428] = true,
    [1220412608] = true,
    [1220412609] = true,
    [136957130] = true,
    [393901260] = true,
    [137084110] = true,
    [1218026702] = true,
    [958854353] = true,
    [1206873301] = true,
    [1310844120] = true,
    [1310844121] = true,
    [278480098] = true,
    [1068139753] = true,
    [1068139754] = true,
    [1075547371] = true,
    [1074771187] = true,
    [1196008693] = true,
    [11941122] = true,
    [71531781] = true,
    [1225192718] = true,
    [413461781] = true,
    [1232217375] = true,
    [1031828770] = true,
    [1206873378] = true,
    [1301546276] = true,
    [1102521636] = true,
    [278480166] = true,
    [1206873386] = true,
    [403871024] = true,
    [1214289205] = true,
    [1214289206] = true,
    [1313074487] = true,
    [1214289207] = true,
    [44479803] = true,
    [1226118462] = true,
    [761339203] = true,
    [1210496325] = true,
    [1154202953] = true,
    [1154202959] = true,
    [154008912] = true,
    [1154202960] = true,
    [177059156] = true,
    [1240454484] = true,
    [1240454485] = true,
    [1226904926] = true,
    [1226904927] = true,
    [424224094] = true,
    [39150942] = true,
    [1313074530] = true,
    [424224098] = true,
    [303193449] = true,
    [1046848878] = true,
    [1046848880] = true,
    [1119507831] = true,
    [303193465] = true,
    [769230207] = true,
    [769230208] = true,
    [238478724] = true,
    [177053062] = true,
    [104758664] = true,
    [104758676] = true,
    [1289076117] = true,
    [1289076118] = true,
    [1288906137] = true,
    [1288906138] = true,
    [58654107] = true,
    [1245859231] = true,
    [1309912482] = true,
    [1091984806] = true,
    [1091984807] = true,
    [1250780583] = true,
    [1250780587] = true,
    [164044209] = true,
    [167105973] = true,
    [170202555] = true,
    [1082351036] = true,
    [1226409414] = true,
    [1095550412] = true,
    [1312433613] = true,
    [1095550413] = true,
    [978900432] = true,
    [1155935702] = true,
    [1155935703] = true,
    [340606430] = true,
    [626599390] = true,
    [101078495] = true,
    [1064398307] = true,
    [328312298] = true,
    [1302506997] = true,
    [1123309047] = true,
    [347948538] = true,
    [1302507004] = true,
    [727234045] = true,
    [988354050] = true,
    [1195970051] = true,
    [988354052] = true,
    [1195970053] = true,
    [330327555] = true,
    [406963717] = true,
    [416630280] = true,
    [406963714] = true,
    [1292162570] = true,
    [1152314894] = true,
    [1152314895] = true,
    [1292162576] = true,
    [177714711] = true,
    [303902232] = true,
    [303902234] = true,
    [1152314910] = true,
    [1085107743] = true,
    [1232811554] = true,
    [1232811555] = true,
    [1101727268] = true,
    [1101727267] = true,
    [1026092579] = true,
    [177714731] = true,
    [48592429] = true,
    [1101727279] = true,
    [1210662450] = true,
    [888481332] = true,
    [1101727287] = true,
    [176866877] = true,
    [142591549] = true,
    [1064799808] = true,
    [10565190] = true,
    [951187015] = true,
    [951187016] = true,
    [1074722377] = true,
    [951187018] = true,
    [176866890] = true,
    [1074722380] = true,
    [176866895] = true,
    [403480144] = true,
    [74032719] = true,
    [74032720] = true,
    [176866900] = true,
    [403480150] = true,
    [403480151] = true,
    [50773593] = true,
    [682286684] = true,
    [714727011] = true,
    [171241061] = true,
    [171241064] = true,
    [178583148] = true,
    [360021617] = true,
    [1041346164] = true,
    [12113524] = true,
    [38758006] = true,
    [1041346167] = true,
    [435742326] = true,
    [1254633085] = true,
    [74450557] = true,
    [74450559] = true,
    [1134818944] = true,
    [1234898564] = true,
    [1134818949] = true,
    [1234898565] = true,
    [1024104083] = true,
    [232150680] = true,
    [40298137] = true,
    [68109978] = true,
    [88204957] = true,
    [135626399] = true,
    [68986527] = true,
    [47214239] = true,
    [1024104099] = true,
    [1204352678] = true,
    [1204352680] = true,
    [43779757] = true,
    [170174129] = true,
    [1218221748] = true,
    [1218221749] = true,
    [47283895] = true,
    [170573499] = true,
    [170573500] = true,
    [482569920] = true,
    [1126403778] = true,
    [1126403779] = true,
    [154742470] = true,
    [1126403786] = true,
    [1126403787] = true,
    [170573521] = true,
    [95768279] = true,
    [170573527] = true,
    [95768281] = true,
    [95768283] = true,
    [95768287] = true,
    [1309097696] = true,
    [95768288] = true,
    [1270822631] = true,
    [1270822632] = true,
    [74385129] = true,
    [74385134] = true,
    [1270822642] = true,
    [1270822643] = true,
    [1270822647] = true,
    [816363256] = true,
    [302536442] = true,
    [302536443] = true,
    [1211631374] = true,
    [47052561] = true,
    [1074409236] = true,
    [869140250] = true,
    [170102558] = true,
    [1081704224] = true,
    [148012839] = true,
    [1111885610] = true,
    [1213521708] = true,
    [170102573] = true,
    [232167217] = true,
    [137082679] = true,
    [1213521720] = true,
    [1092607805] = true,
    [44093249] = true,
    [1073731394] = true,
    [1081124673] = true,
    [1081124674] = true,
    [1081124675] = true,
    [1155731271] = true,
    [416489292] = true,
    [978095950] = true,
    [1126139728] = true,
    [1126139733] = true,
    [978095958] = true,
    [1126139734] = true,
    [978095960] = true,
    [461504346] = true,
    [375207771] = true,
    [461504347] = true,
    [776378207] = true,
    [1077708640] = true,
    [10631011] = true,
    [10631013] = true,
    [1092607848] = true,
    [340586353] = true,
    [1219923831] = true,
    [50177930] = true,
    [69705611] = true,
    [69013389] = true,
    [1309394830] = true,
    [1309394831] = true,
    [74424206] = true,
    [74424207] = true,
    [729546642] = true,
    [91553681] = true,
    [1309394837] = true,
    [1309394838] = true,
    [417230742] = true,
    [257439637] = true,
    [1309394841] = true,
    [1202851735] = true,
    [1301698459] = true,
    [91553686] = true,
    [1231122326] = true,
    [1309394847] = true,
    [193742762] = true,
    [121143210] = true,
    [66394032] = true,
    [66394035] = true,
    [330770358] = true,
    [1234890680] = true,
    [1234890681] = true,
    [760455098] = true,
    [163764156] = true,
    [40779710] = true,
    [68992964] = true,
    [43925447] = true,
    [39151562] = true,
    [657297355] = true,
    [657297356] = true,
    [106903507] = true,
    [163764181] = true,
    [163764183] = true,
    [68992985] = true,
    [1092108254] = true,
    [1092108256] = true,
    [1206661089] = true,
    [1206661088] = true,
    [47052771] = true,
    [1206661091] = true,
    [1206661092] = true,
    [1094666217] = true,
    [71835626] = true,
    [1206333418] = true,
    [106903532] = true,
    [1206333419] = true,
    [981127150] = true,
    [687003631] = true,
    [1094666224] = true,
    [1094666225] = true,
    [981127151] = true,
    [106903540] = true,
    [163725303] = true,
    [163725304] = true,
    [163725305] = true,
    [436828155] = true,
    [106903550] = true,
}

local function isInSet(elmt)
    return cameraSet[elmt] ~= nil
end
-- Car profile
api_version = 4
Set = require('lib/set')
Sequence = require('lib/sequence')
Handlers = require("lib/way_handlers")
Relations = require("lib/relations")
TrafficSignal = require("lib/traffic_signal")
find_access_tag = require("lib/access").find_access_tag
limit = require("lib/maxspeed").limit
Utils = require("lib/utils")
Measure = require("lib/measure")

function setup()
  return {
    properties = {
      max_speed_for_map_matching      = 180/3.6, -- 180kmph -> m/s
      -- For routing based on duration, but weighted for preferring certain roads
      weight_name                     = 'routability',
      -- For shortest duration without penalties for accessibility
      -- weight_name                     = 'duration',
      -- For shortest distance without penalties for accessibility
      -- weight_name                     = 'distance',
      process_call_tagless_node      = false,
      u_turn_penalty                 = 20,
      continue_straight_at_waypoint  = true,
      use_turn_restrictions          = true,
      left_hand_driving              = false,
      traffic_light_penalty          = 2,
    },

    default_mode              = mode.driving,
    default_speed             = 10,
    oneway_handling           = true,
    side_road_multiplier      = 0.8,
    turn_penalty              = 7.5,
    speed_reduction           = 0.8,
    turn_bias                 = 1.075,
    cardinal_directions       = false,

    -- Size of the vehicle, to be limited by physical restriction of the way
    vehicle_height = 2.0, -- in meters, 2.0m is the height slightly above biggest SUVs
    vehicle_width = 1.9, -- in meters, ways with narrow tag are considered narrower than 2.2m

    -- Size of the vehicle, to be limited mostly by legal restriction of the way
    vehicle_length = 4.8, -- in meters, 4.8m is the length of large or family car
    vehicle_weight = 2000, -- in kilograms

    -- a list of suffixes to suppress in name change instructions. The suffixes also include common substrings of each other
    suffix_list = {
      'N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW', 'North', 'South', 'West', 'East', 'Nor', 'Sou', 'We', 'Ea'
    },

    barrier_whitelist = Set {
      'cattle_grid',
      'border_control',
      'toll_booth',
      'sally_port',
      'gate',
      'lift_gate',
      'no',
      'entrance',
      'height_restrictor',
      'arch'
    },

    access_tag_whitelist = Set {
      'yes',
      'motorcar',
      'motor_vehicle',
      'vehicle',
      'permissive',
      'designated',
      'hov'
    },

    access_tag_blacklist = Set {
      'no',
      'agricultural',
      'forestry',
      'emergency',
      'psv',
      'customers',
      'private',
      'delivery',
      'destination'
    },

    -- tags disallow access to in combination with highway=service
    service_access_tag_blacklist = Set {
        'private'
    },

    restricted_access_tag_list = Set {
      'private',
      'delivery',
      'destination',
      'customers',
    },

    access_tags_hierarchy = Sequence {
      'motorcar',
      'motor_vehicle',
      'vehicle',
      'access'
    },

    service_tag_forbidden = Set {
      'emergency_access'
    },

    restrictions = Sequence {
      'motorcar',
      'motor_vehicle',
      'vehicle'
    },

    classes = Sequence {
        'toll', 'motorway', 'ferry', 'restricted', 'tunnel'
    },

    -- classes to support for exclude flags
    excludable = Sequence {
        Set {'toll'},
        Set {'motorway'},
        Set {'ferry'}
    },

    avoid = Set {
      'area',
      -- 'toll',    -- uncomment this to avoid tolls
      'reversible',
      'impassable',
      'hov_lanes',
      'steps',
      'construction',
      'proposed'
    },

    speeds = Sequence {
      highway = {
        motorway        = 90,
        motorway_link   = 45,
        trunk           = 85,
        trunk_link      = 40,
        primary         = 65,
        primary_link    = 30,
        secondary       = 55,
        secondary_link  = 25,
        tertiary        = 40,
        tertiary_link   = 20,
        unclassified    = 25,
        residential     = 25,
        living_street   = 10,
        service         = 15
      }
    },

    service_penalties = {
      alley             = 0.5,
      parking           = 0.5,
      parking_aisle     = 0.5,
      driveway          = 0.5,
      ["drive-through"] = 0.5,
      ["drive-thru"] = 0.5
    },

    restricted_highway_whitelist = Set {
      'motorway',
      'motorway_link',
      'trunk',
      'trunk_link',
      'primary',
      'primary_link',
      'secondary',
      'secondary_link',
      'tertiary',
      'tertiary_link',
      'residential',
      'living_street',
      'unclassified',
      'service'
    },

    construction_whitelist = Set {
      'no',
      'widening',
      'minor',
    },

    route_speeds = {
      ferry = 5,
      shuttle_train = 10
    },

    bridge_speeds = {
      movable = 5
    },

    -- surface/trackype/smoothness
    -- values were estimated from looking at the photos at the relevant wiki pages

    -- max speed for surfaces
    surface_speeds = {
      asphalt = nil,    -- nil mean no limit. removing the line has the same effect
      concrete = nil,
      ["concrete:plates"] = nil,
      ["concrete:lanes"] = nil,
      paved = nil,

      cement = 80,
      compacted = 80,
      fine_gravel = 80,

      paving_stones = 60,
      metal = 60,
      bricks = 60,

      grass = 40,
      wood = 40,
      sett = 40,
      grass_paver = 40,
      gravel = 40,
      unpaved = 40,
      ground = 40,
      dirt = 40,
      pebblestone = 40,
      tartan = 40,

      cobblestone = 30,
      clay = 30,

      earth = 20,
      stone = 20,
      rocky = 20,
      sand = 20,

      mud = 10
    },

    -- max speed for tracktypes
    tracktype_speeds = {
      grade1 =  60,
      grade2 =  40,
      grade3 =  30,
      grade4 =  25,
      grade5 =  20
    },

    -- max speed for smoothnesses
    smoothness_speeds = {
      intermediate    =  80,
      bad             =  40,
      very_bad        =  20,
      horrible        =  10,
      very_horrible   =  5,
      impassable      =  0
    },

    -- http://wiki.openstreetmap.org/wiki/Speed_limits
    maxspeed_table_default = {
      urban = 50,
      rural = 90,
      trunk = 110,
      motorway = 130
    },

    -- List only exceptions
    maxspeed_table = {
      ["at:rural"] = 100,
      ["at:trunk"] = 100,
      ["be:motorway"] = 120,
      ["be-bru:rural"] = 70,
      ["be-bru:urban"] = 30,
      ["be-vlg:rural"] = 70,
      ["bg:motorway"] = 140,
      ["by:urban"] = 60,
      ["by:motorway"] = 110,
      ["ca-on:rural"] = 80,
      ["ch:rural"] = 80,
      ["ch:trunk"] = 100,
      ["ch:motorway"] = 120,
      ["cz:trunk"] = 0,
      ["cz:motorway"] = 0,
      ["de:living_street"] = 7,
      ["de:rural"] = 100,
      ["de:motorway"] = 0,
      ["dk:rural"] = 80,
      ["es:trunk"] = 90,
      ["fr:rural"] = 80,
      ["gb:nsl_single"] = (60*1609)/1000,
      ["gb:nsl_dual"] = (70*1609)/1000,
      ["gb:motorway"] = (70*1609)/1000,
      ["nl:rural"] = 80,
      ["nl:trunk"] = 100,
      ['no:rural'] = 80,
      ['no:motorway'] = 110,
      ['ph:urban'] = 40,
      ['ph:rural'] = 80,
      ['ph:motorway'] = 100,
      ['pl:rural'] = 100,
      ['pl:trunk'] = 120,
      ['pl:motorway'] = 140,
      ["ro:trunk"] = 100,
      ["ru:living_street"] = 20,
      ["ru:urban"] = 60,
      ["ru:motorway"] = 110,
      ["uk:nsl_single"] = (60*1609)/1000,
      ["uk:nsl_dual"] = (70*1609)/1000,
      ["uk:motorway"] = (70*1609)/1000,
      ['za:urban'] = 60,
      ['za:rural'] = 100,
      ["none"] = 140
    },

    relation_types = Sequence {
      "route"
    },

    -- classify highway tags when necessary for turn weights
    highway_turn_classification = {
    },

    -- classify access tags when necessary for turn weights
    access_turn_classification = {
    }
  }
end

function process_node(profile, node, result, relations)
  -- parse access and barrier tags
  local access = find_access_tag(node, profile.access_tags_hierarchy)
  if access then
    if profile.access_tag_blacklist[access] and not profile.restricted_access_tag_list[access] then
      result.barrier = true
    end
  else
    local barrier = node:get_value_by_key("barrier")
    if barrier then
      --  check height restriction barriers
      local restricted_by_height = false
      if barrier == 'height_restrictor' then
         local maxheight = Measure.get_max_height(node:get_value_by_key("maxheight"), node)
         restricted_by_height = maxheight and maxheight < profile.vehicle_height
      end

      --  make an exception for rising bollard barriers
      local bollard = node:get_value_by_key("bollard")
      local rising_bollard = bollard and "rising" == bollard

      -- make an exception for lowered/flat barrier=kerb
      -- and incorrect tagging of highway crossing kerb as highway barrier
      local kerb = node:get_value_by_key("kerb")
      local highway = node:get_value_by_key("highway")
      local flat_kerb = kerb and ("lowered" == kerb or "flush" == kerb)
      local highway_crossing_kerb = barrier == "kerb" and highway and highway == "crossing"

      if not profile.barrier_whitelist[barrier]
                and not rising_bollard
                and not flat_kerb
                and not highway_crossing_kerb
                or restricted_by_height then
        result.barrier = true
      end
    end
  end

  -- check if node is a traffic light
  result.traffic_lights = TrafficSignal.get_value(node)
end

function process_way(profile, way, result, relations)
  -- HACK TODO
  -- 根据标签的存在初步筛选方式
  -- 会大大影响处理时间，因为所有方式
  -- 都必须检查。
  -- 为了提高性能，预取和初始标记检查
  -- 直接进行，而不是通过处理程序。

  -- 一般情况下，如果路由不成功，我们应该尽快终止
  -- 一般来说，如果路由不可行，我们应该尽快放弃，以避免做
  -- 这意味着我们应该尽早检查
  -- 通常禁止访问的东西，然后再处理边缘情况。

  -- 处理过程中用于存储中间值的数据表
  local data = {
    -- prefetch tags
    bridge = way:get_value_by_key('bridge'),
    tunnel = way:get_value_by_key('tunnel'),
    motorcycle = way:get_value_by_key('motorcycle'),
    highway = way:get_value_by_key('highway'),
    route = way:get_value_by_key('route'),
    -- osmId = way:get_value_by_key('osm_id')
  }

  

  -- if isInSet(way.osm_id) or isInSet(way:get_value_by_key('osm_id')) or isInSet(way:get_value_by_key('id')) then
  --   return -- 被摄像头拍摄
  -- end
  if isInSet(way:id()) then
    return
  end

  if data.motorcycle ~= "yes" then
    if data.tunnel == "yes" then -- data.bridge == "yes" or 
      return -- 如果是桥梁不允许,隧道不允许,摩托车不允许
    end

    -- if data.bridge == "yes" then -- data.bridge == "yes" or 
    --   return -- 如果是桥梁不允许,隧道不允许,摩托车不允许
    -- end
    
    if data.highway == "motorway" or data.highway == "motorway_link" or data.highway == "trunk" then
        return   -- 判断是否为高速公路、高速连接道或主干道
    end
    if data.route == "ferry" or data.route == "shuttle_train" then
      return -- 如果是隧道或特定路段的情况
    end
  end



  -- 执行快速初步检查，如果道路
  -- 显然不可路由。
  if (not data.highway or data.highway == '') and
  (not data.route or data.route == '')
  then
    return
  end

  handlers = Sequence {
    -- set the default mode for this profile. if can be changed later
    -- in case it turns we're e.g. on a ferry
    WayHandlers.default_mode,

    -- check various tags that could indicate that the way is not
    -- routable. this includes things like status=impassable,
    -- toll=yes and oneway=reversible
    WayHandlers.blocked_ways,
    WayHandlers.avoid_ways,
    WayHandlers.handle_height,
    WayHandlers.handle_width,
    WayHandlers.handle_length,
    WayHandlers.handle_weight,

    -- determine access status by checking our hierarchy of
    -- access tags, e.g: motorcar, motor_vehicle, vehicle
    WayHandlers.access,

    -- check whether forward/backward directions are routable
    WayHandlers.oneway,

    -- check a road's destination
    WayHandlers.destinations,

    -- check whether we're using a special transport mode
    WayHandlers.ferries,
    WayHandlers.movables,

    -- handle service road restrictions
    WayHandlers.service,

    -- handle hov
    WayHandlers.hov,

    -- compute speed taking into account way type, maxspeed tags, etc.
    WayHandlers.speed,
    WayHandlers.maxspeed,
    WayHandlers.surface,
    WayHandlers.penalties,

    -- compute class labels
    WayHandlers.classes,

    -- handle turn lanes and road classification, used for guidance
    WayHandlers.turn_lanes,
    WayHandlers.classification,

    -- handle various other flags
    WayHandlers.roundabouts,
    WayHandlers.startpoint,
    WayHandlers.driving_side,

    -- set name, ref and pronunciation
    WayHandlers.names,

    -- set weight properties of the way
    WayHandlers.weights,

    -- set classification of ways relevant for turns
    WayHandlers.way_classification_for_turn
  }

  WayHandlers.run(profile, way, result, data, handlers, relations)

  if profile.cardinal_directions then
      Relations.process_way_refs(way, relations, result)
  end
end

function process_turn(profile, turn)
  -- Use a sigmoid function to return a penalty that maxes out at turn_penalty
  -- over the space of 0-180 degrees.  Values here were chosen by fitting
  -- the function to some turn penalty samples from real driving.
  local turn_penalty = profile.turn_penalty
  local turn_bias = turn.is_left_hand_driving and 1. / profile.turn_bias or profile.turn_bias

  if turn.has_traffic_light then
      turn.duration = profile.properties.traffic_light_penalty
  end

  if turn.number_of_roads > 2 or turn.source_mode ~= turn.target_mode or turn.is_u_turn then
    if turn.angle >= 0 then
      turn.duration = turn.duration + turn_penalty / (1 + math.exp( -((13 / turn_bias) *  turn.angle/180 - 6.5*turn_bias)))
    else
      turn.duration = turn.duration + turn_penalty / (1 + math.exp( -((13 * turn_bias) * -turn.angle/180 - 6.5/turn_bias)))
    end

    if turn.is_u_turn then
      turn.duration = turn.duration + profile.properties.u_turn_penalty
    end
  end

  -- for distance based routing we don't want to have penalties based on turn angle
  if profile.properties.weight_name == 'distance' then
     turn.weight = 0
  else
     turn.weight = turn.duration
  end

  if profile.properties.weight_name == 'routability' then
      -- penalize turns from non-local access only segments onto local access only tags
      if not turn.source_restricted and turn.target_restricted then
          turn.weight = constants.max_turn_weight
      end
  end
end

return {
  setup = setup,
  process_way = process_way,
  process_node = process_node,
  process_turn = process_turn
}
